---
title: "Team Notebook"
author: "Aidan Hughes, Aya Hussein, Caley Fox Shannon"
date: "`r Sys.Date()`"
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

For our data analysis project, we have chosen to look at House of Representatives Office Expenditures. We think that the dataset is rich with newsworthy details and we know that the public is generally interested in how lawmakers spend their tax dollars.


## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}

# Turn off scientific notation. 

options(scipen=999)

# Load libraries. 

library(tidyverse)
library(readr)
library(scales)
library(janitor)

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}

# Load the data from ProPublica.

# Watch out for "subtotal" rows -- need to filter those out when doing calculations to avoid doubling the real total

# "DATE" column seems to pertain to the date the expense was filed, whereas the start and end date cols seem to pertain to the dates of the expenses themselves. for example, q4_2019 has expenses that go back all the way to 2011

# YEAR is not always populated. When it is, it seems to pertain to the filing year rather than the expense year.

# QUARTER is sometimes unpopulated, sometimes populated with a numeric, and sometimes populated with a chr (eg "Q2" instead of just "2").

# DATE col values aren't always populated (within the same df some rows are and some rows aren't). Can't use it to extract quarter and year values.

# Did the cleaning one-by-one while exploring the distinct issues across different files. Will make this more concise in the near future by using regex and a for loop to iterate across a list of dfs and make the year and quarter updates. We'll then only need to apply additional fixes to q4_2022, q4_2021, q1_2020 and q3_2018

q4_2022 <- read_csv("data/2022Q4.csv") %>%
  mutate(YEAR = as.numeric(2022)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("4")) %>%
  rename(start_date = perform_start_dt,
         end_date = perform_end_dt)
  

q3_2022 <- read_csv("data/2022Q3.csv") %>%
  mutate(YEAR = as.numeric(2022)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("3"))


q2_2022 <- read_csv("data/2022Q2.csv") %>%
  mutate(YEAR = as.numeric(2022)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("2"))


q1_2022 <- read_csv("data/2022Q1.csv")%>%
  mutate(YEAR = as.numeric(2022)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("1"))
# Need to populate the QUARTER column

q4_2021 <- read_csv("data/2021Q4.csv") %>%
  mutate(YEAR = as.numeric(2021)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("4"))
# parsing errors in row 27712:
# row   col expected        actual     file 
#  <int> <int> <chr>           <chr>      <chr>
#1 27712    12 date in ISO8601 4-Jul-21   ""   
#2 27712    14 15 columns      14 columns ""

# Needed to manually add the value 2021-07-04 to q4_2021[27711,12]
q4_2021[27711,12] = as.Date("2021-07-04")

q3_2021 <- read_csv("data/2021Q3.csv") %>%
  mutate(YEAR = as.numeric(2021)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("3"))

q2_2021 <- read_csv("data/2021Q2.csv")%>%
  mutate(YEAR = as.numeric(2021)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("2"))
# Need to populate the QUARTER column

q1_2021 <- read_csv("data/2021Q1.csv")%>%
  mutate(YEAR = as.numeric(2021)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("1"))

q4_2020 <- read_csv("data/2020Q4.csv")%>%
  mutate(YEAR = as.numeric(2020)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("4"))


q3_2020 <- read_csv("data/2020Q3.csv")%>%
  mutate(YEAR = as.numeric(2020)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("3"))


q2_2020 <- read_csv("data/2020Q2.csv")%>%
  mutate(YEAR = as.numeric(2020)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("2"))


q1_2020 <- read_csv("data/2020Q1.csv")%>%
  mutate(YEAR = as.numeric(2020)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("1"))
# parsing errors in :
#      row   col expected actual file 
#    <int> <int> <chr>    <chr>  <chr>
# 1 121790    16 a double FISC   ""   
# 2 121791    16 a double FISC   ""   
# 3 121792    16 a double FISC   ""   
# 4 121793    16 a double FISC   ""   
# 5 132094    16 a double FISC   ""   
# 6 132095    16 a double FISC   ""   
# 7 132096    16 a double FISC   ""   
# 8 132097    16 a double FISC   ""   
# 9 132098    16 a double FISC   ""   
#10 132099    16 a double FISC   ""   
#11 132100    16 a double FISC   ""   
#12 132101    16 a double FISC   ""   
#13 132102    16 a double FISC   ""   
#14 132103    16 a double FISC   ""   
#15 132104    16 a double FISC   ""   
#16 132105    16 a double FISC   ""   
#17 132106    16 a double FISC   ""   
#18 132107    16 a double FISC   ""   
#19 132108    16 a double FISC   ""   
#20 132109    16 a double FISC   ""

# The parsing issue is that "FISC" is showing up in 20 rows in the YEAR column. R has changed those values to NULL by default.
# No further action required on the parsing issue
# what does the id column here refer to since there's also already a bioguide_id?


q4_2019 <- read_csv("data/2019Q4.csv")%>%
  mutate(YEAR = as.numeric(2019)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("4"))


q3_2019 <- read_csv("data/2019Q3.csv")%>%
  mutate(YEAR = as.numeric(2019)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("3"))


q2_2019 <- read_csv("data/2019Q2.csv")%>%
  mutate(YEAR = as.numeric(2019)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("2"))
# QUARTER col is in format "Q2" rather than just "2"

q1_2019 <- read_csv("data/2019Q1.csv")%>%
  mutate(YEAR = as.numeric(2019)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("1"))


q4_2018 <- read_csv("data/2018Q4.csv")%>%
  mutate(YEAR = as.numeric(2018)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("4"))


q3_2018 <- read_csv("data/2018Q3.csv") %>%
  mutate(YEAR = as.numeric(2018)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("3"))
# Parsing issues:
#    row   col expected        actual      file 
#  <int> <int> <chr>           <chr>       <chr>
# 1 90121    11 date in ISO8601 22-AUG-1818 "" 

# Need to manually update q3_2018[90120, 11] to 2018-08-22
q3_2018[90120, 11] = as.Date("2018-08-22")

q2_2018 <- read_csv("data/2018Q2.csv")%>%
  mutate(YEAR = as.numeric(2018)) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("2"))

q1_2018 <- read_csv("data/2018Q1.csv")%>%
  mutate(YEAR = as.numeric("2018")) %>%
  clean_names() %>%
  mutate(quarter = as.numeric("1"))




```


```{r}

# Bind dataframes into one combined dataframe  

house_spend_18_23 <- bind_rows(list(q4_2022, q3_2022, q2_2022, q1_2022, q4_2021, q3_2021, q2_2021, q1_2021, q4_2020, q3_2020, q2_2020, q1_2020, q4_2019, q3_2019, q2_2019, q1_2019, q4_2018, q3_2018, q2_2018, q1_2018))

```


Data dictionary questions:

"DATE" column seems to pertain to the date the expense was filed, whereas the start and end date cols seem to pertain to the dates of the expenses themselves. for example, q4_2019 has expenses that go back all the way to 2011.

  - Confirm "DATE" is filing date - CONFIRMED
  - Why does q4_2019 have expenses that go back all the way to 2011? - SOMETIMES A MEMBER'S OFFICE WILL REALIZE THERE WAS A BOOKEEPING ERROR EVEN FURTHER BACK THAN THE THREE YEAR LIMIT MENTIONED IN THE PROPUBLICA ARTICLE. OTHER TIMES, A VENDOR WILL IDENTIFY A BOOKEEPING ERROR FROM YEARS PRRIOR ON THEIR END AND NOTIFY THE MEMBER'S OFFICE ABOUT IT, AND THEN THE MEMBER'S OFFICE WILL UPDATE THEIR BOOKS TOO

YEAR seems to pertain to the filing year rather than the expense year.

  - Confirm? - CONFIRMED


The start and end date cols seem to pertain to the dates of the expenses themselves.

  - Confirm? - CONFIRMED
  
When the amount is negative, what does that signify?

- THIS IS WHEN THE MEMBER'S OFFICE IS REBATED FOR EXPENSES. FOR EXAMPLE, MAYBE THE OFFICE CANCELED A $1MIL CONTRACT WITH A VENDOR AFTER ONLY SPENDING 200K, SO AN -800K RECORD WILL APPEAR.


## Sentences to Engineer
In this notebook, we are reverse engineering five sentences from the story.

### Sentence 1

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 2

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 3

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 4

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

### Sentence 5

* **Sentence text**: [Paste in sentence to engineer here]
* **Analysis summary**: [Write up two to three sentences describing the results of your analysis.  Were you able to confirm the finding? If not, why not?]

```{r}
# Put code to reverse engineer sentence here

# Display results of code below this codeblock

```

