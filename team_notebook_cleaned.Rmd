---
title: "Data Analysis Team 3 Notebook - POST CLEAN ANALYSIS ONLY"
author: "Aidan Hughes, Aya Hussein, Caley Fox Shannon"
date: "`r Sys.Date()`"
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

For our data analysis project, we have chosen to look at House of Representatives Office Expenditures. We think that the dataset is rich with newsworthy details and we know that the public is generally interested in how lawmakers spend our tax dollars.

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}

# Turn off scientific notation. 

options(scipen=999)

# Load libraries. 

library(tidyverse)
library(readr)
library(scales)
library(janitor)
library(ggplot2)

```

## Load and Cleaning Data. 

To run the full data clean, see the notebook "clean_only.rmd" For ease, this analysis will begin with a read in of the cleaned dataframes.

```{r}

# Begin by reading in the four dataframes that were created in "clean_only.rmd" 

# Spend_with_member_info.csv is too large to push via GitHub, please see WeTransfer and drop into data folder for this repository on desktop. 

spend_with_member_info <- read_csv("data/spend_with_member_info.csv")

dmv_spend_with_member_info <- read_csv("data/dmv_spend_with_member_info.csv")

house_spend_18_22 <- read_csv("data/house_spend_18_22.csv")

totals_dmv_spend <- read_csv("data/totals_dmv_spend.csv")

```

## Do some basic aggregates to make sure that further cleaning isn't needed. 

```{r}

# Let's look at the spending categories (column is called purpose) to get a general sense of where reps are using their budgets. 

totals_dmv_spend_purpose <- totals_dmv_spend %>%
  group_by(purpose) %>%
  summarise(total_expenses = sum(amount)) %>%
  arrange(desc(total_expenses))

totals_dmv_spend_purpose 

# OFFICIAL EXPENSES OF MEMBER TOTALS sounds really vague, and it's the top category by far with a spend of $135,333,002.69. We also notice that Official Expenses of Members is one of the two options for the "program" column in totals_dmv_spend. That seems like a red flag. 

# The other value in the program column is INTERN ALLOWANCES. We have a column in totals_dmv_spend_purpose called INTERN ALLOWANCES TOTALS: as well, which totals $1,532,417.41

# Are these two values in the purpose category redundant? Let's save these numbers, then filter the two rows out and see if they equal the sum of all other purposes that remain. 

official <- 135333002.69
interns <- 1532417.41

totals_dmv_spend_purpose <- totals_dmv_spend %>%
  filter(purpose != "OFFICIAL EXPENSES OF MEMBERS TOTALS:")|> 
  filter(purpose != "INTERN ALLOWANCES TOTALS:")|> 
  group_by(purpose) %>%
  summarise(total_expenses = sum(amount)) %>%
  arrange(desc(total_expenses))

totals_dmv_spend_purpose 

# What's the sum of all of the remaining 9 categories? Does it equal the sum of OFFICIAL EXPENSES OF MEMBER TOTALS and INTERN ALLOWANCES? 

without_official_interns <- sum(totals_dmv_spend_purpose$total_expenses)
	
remainder <- (without_official_interns - official - interns)

remainder

# We have an extremely small decimal here that would have been rounded to zero for accounting purposes. So that appears to be a total redundancy after all. 

# Let's resave totals_dmv_spend so that we are permanently excluding these redundancies when working with that dataframe. 

totals_dmv_spend <- totals_dmv_spend %>%
  filter(purpose != "OFFICIAL EXPENSES OF MEMBERS TOTALS:")|> 
  filter(purpose != "INTERN ALLOWANCES TOTALS:")

# Just double checking that now we have only the appropriate 9 options for purpose. 

totals_dmv_spend_purpose <- totals_dmv_spend %>%
  group_by(purpose) %>%
  summarise(total_expenses = sum(amount)) %>%
  arrange(desc(total_expenses))

totals_dmv_spend_purpose 

# Let's get a percent of total column as well to get a sense of where reps are spending the most and least across the 9 categories. 

totals_dmv_spend_purpose <- totals_dmv_spend_purpose |> 
  mutate(pct_of_total = (total_expenses/(sum(total_expenses)))*100)

```


### Question 1

* **Question**: Do US reps from DC, Maryland and Virginia spend less on average than their colleagues? It seems logical that they would spend significantly less at least on travel, but is that the case? If so, does that mean they spend less overall, or do they outspend their peers in other categories?

* **Analysis summary**: Overall, reps spent an average of $1.2 to nearly $1.7 million each year. Their budgets steadily increased year over year between 2018 and 2022. 

We found that compared to the average in Congress, reps from the DMV spend $15,254.09 less each year. We also looked at their travel spending, and found that they spent on average $32,870.38 less annually per year. That means they probably outspend their peers in some other categories, but at least they spend less overall as we expected. 

So we looked at how DMV reps allocate their budget, by percent, compared to the national averages. And it turns out that they spend 2.5% more of their budget on compensation and almost half a percent more on rent, communication and utilities. It would be interesting to look at these numbers more closely. Do DMV reps pay for more office space near the capital, which we know to be higher than national averages? The same question goes for salary, do they have to pay staff more because so many live full time in the DMV where cost of living is high? In another analysis, it may be interesting to compare spending by DMV reps to those from other high cost-of-living areas like the Bay or NYC. 

```{r}

# We need to look at the overall house spend but first let's rid it of the redundancies we found above with Official Member Expenses and Intern Allowance.  

house_spend_18_22 <- house_spend_18_22 |> 
  filter(purpose != "OFFICIAL EXPENSES OF MEMBERS TOTALS:")|> 
  filter(purpose != "INTERN ALLOWANCES TOTALS:")

house_spend_18_22 
```


```{r}

# Calculate average spend for all members, not just those in the DMV. First, filter out non-member offices and committees to confirm that there are 435 unique members per year. 

house_spend_18_22 <- house_spend_18_22 %>%
  filter(!is.na(bioguide_id))

house_spend_18_22 %>%
  filter(office_year >= 2018) %>%
  group_by(office_year, bioguide_id) %>%
  summarise() %>%
  group_by(office_year) %>%
  summarise(count = n())

# Surprisingly, there are more than 435 members each year even after we've filtered out records without a bioguide_id and by the office_year (which is intended to avoid any confusion about offices changing hands in January). But we do know that sometimes reps pass away, are appointed to other positions, or leave their seats for other reasons and are replaced. So we'll need to divide by the numbers above to find our average rather than 435 for every year. 

house_spend_18_22_totals <- house_spend_18_22 %>%
  group_by(year) %>%
  summarise(annual_total = sum(amount)) %>%
  mutate(members_per_year = c(451, 447, 442, 451, 448)) %>%
  mutate(annual_avg_per_member = annual_total / members_per_year)

house_spend_18_22_totals 
  
```

```{r}
# Now do the same process for DMV reps. 

totals_dmv_spend %>%
  filter(office_year >= 2018) %>%
  group_by(office_year, bioguide_id) %>%
  summarise() %>%
  group_by(office_year) %>%
  summarise(count = n())

totals_dmv_spend_totals <- totals_dmv_spend %>%
  group_by(year) %>%
  summarise(dmv_annual_total = sum(amount)) %>%
  mutate(dmv_annual_avg_per_member = dmv_annual_total / 20)

totals_dmv_spend_totals

```

```{r}
# Now join to compare side by side. 

house_dmv_totals <- house_spend_18_22_totals |> 
  left_join(totals_dmv_spend_totals, join_by(year))

house_dmv_totals

house_dmv_totals <- house_dmv_totals |> 
  group_by(year, annual_avg_per_member, dmv_annual_avg_per_member)|> 
  summarise(difference = annual_avg_per_member - dmv_annual_avg_per_member)

average_total_difference <- mean(house_dmv_totals$difference)

average_total_difference 

# So on average, DMV reps spent less every year than the House as a whole did, on average $15,254.09 less per member each year. 
```


```{r}

# Now let's test the hypothesis that DMV reps probably spend less on transportation than other members do. 

house_spend_18_22_travel <- house_spend_18_22 %>%
  filter(purpose == "TRAVEL TOTALS:") %>%
  #need to group_by and calculate avgs per year so our avgs aren't skewed based on how many years a member has served
  group_by(year) %>%
  summarise(annual_total = sum(amount)) %>%
  mutate(members_per_year = c(451, 447, 442, 451, 448)) %>%
  mutate(annual_avg_per_member = annual_total / members_per_year)
  
house_spend_18_22_travel

dmv_spend_travel <- totals_dmv_spend %>%
  filter(purpose == "TRAVEL TOTALS:") %>%
  #need to group_by and calculate avgs per year so our avgs aren't skewed based on how many years a member has served
  group_by(year) %>%
  summarise(dmv_annual_total = sum(amount)) %>%
  mutate(dmv_annual_avg_per_member = dmv_annual_total / 20)

dmv_spend_travel

house_dmv_travel <- house_spend_18_22_travel |> 
  left_join(dmv_spend_travel, join_by(year))

house_dmv_travel

house_dmv_travel<- house_dmv_travel |> 
  group_by(year, annual_avg_per_member, dmv_annual_avg_per_member)|> 
  summarise(difference = annual_avg_per_member - dmv_annual_avg_per_member)

house_dmv_travel

average_difference <- mean(house_dmv_travel$difference)

average_difference

# Hypothesis confirmed that they spend substantially less on travel than other members, on average more $32,870.38 less annually per member. But they only spend ~$15.2K less than others overall, meaning that they are overspending somewhere else. 

```

```{r}
# Let's look at spending by category to figure out where DMV reps are actually outspending their colleagues. Because we already have totals_dmv_spend_purpose, we'll create an analogous df for the house to compare spending by percent allocation across the 9 categories.

house_spend_18_22_purpose <- house_spend_18_22 %>%
  group_by(purpose) %>%
  summarise(house_total_expenses = sum(amount)) %>%
  arrange(desc(house_total_expenses))|> 
  mutate(house_pct_of_total = (house_total_expenses/(sum(house_total_expenses)))*100)

totals_dmv_spend_purpose <- totals_dmv_spend_purpose |> 
  rename(dmv_total_expenses = total_expenses)|> 
  rename(dmv_pct_of_total = pct_of_total)

# Join to compare side by side.  

category_comparison <- house_spend_18_22_purpose |> 
  left_join(totals_dmv_spend_purpose, join_by(purpose))

# Add a column that shows the percent difference between DMV rep and overall rep spending across the categories. 

category_comparison <- category_comparison |> 
  mutate(dmv_difference = dmv_pct_of_total - house_pct_of_total)

```


### Question 2

* **Question**: Which political party in the DMV does the most spending, and does that change with whether or not that party holds the majority in the House?

* **Analysis summary**: When it comes to overall spending by party, Democratic reps from the DMV in the house are spending way more than Republicans. But that's because more of the 20 total reps are Democrats. In 2018 when Republicans held the majority, the DMV had 8 Republican reps. Since Democrats took the majority from 2019-2022, there have only been 5 Republicans representing the DMV. 

We need to look at average spending per member to get a more accurate picture of spending trends, and there we did not find a very strong correlation between a DMV rep's party and whether or not the party was in the majority. Republican reps from the DMV spent more on average than Democrats did in 2018 when they were in the majority, but they also spent more in 2020 and 2021 when they were not. Democratic reps from the DMV outspent DMV Republicans in 2019 and 2022. 

```{r}
# First we needed to do a little research about who controlled the House from 2018-2022. It was Republicans in 2018 and Democrats every other year, so we made a simple spreadsheet to import. 

house_majority <- read_csv("data/house_majority.csv")

# Join with the totals_dmv_spend dataframe 

totals_dmv_spend <- totals_dmv_spend |> 
  left_join(house_majority, join_by("office_year" == "year"))

totals_dmv_spend
```

```{r}
# Look at spending by party each year. 

totals_dmv_spend |>
  filter(office_year >= 2018)|> 
  group_by(office_year, party, majority_party)|> 
  summarise(party_spend = sum(amount))

# Clearly Democrats are way outspending Republicans overall. But is that just because there are most Democrats representing the DMV. We need to look at average spending per member. 

# To do that, we have to find the number of members each party had in the DMV each year. We know there are 20 seats total. This will allow us to calculate an average spend by party for each year. First, make a df with one row per member per year, along with their party

all_members_per_year <- totals_dmv_spend %>%
  filter(office_year >=2018)  %>%
  group_by(office_year,bioguide_id,party) %>%
  summarise()

all_members_per_year

# Calculate party members per year. 

members_grouped_per_year <- all_members_per_year %>%
  group_by(party, office_year) %>%
  summarise(party_members_per_year = n()) %>%
  arrange(office_year)

members_grouped_per_year

# Calculate how much each party spent per year. 

party_spending_annual <- totals_dmv_spend |>
  filter(office_year >=2018)  %>%
  group_by(party, office_year, majority_party)|>
  summarise(party_spend = sum(amount))|>
  arrange(desc(party_spend)) %>%
  arrange(office_year)

party_spending_annual
```

```{r}
# Join the dfs and calculate an average spend per member for each party per year.  

party_spending_w_rep_numbers <- party_spending_annual %>%
  left_join(members_grouped_per_year) %>%
  mutate(avg_spend_per_member = party_spend / party_members_per_year) %>%
  arrange(desc(avg_spend_per_member)) 

party_spending_w_rep_numbers|> 
  select(-party_spend, -party_members_per_year)|> 
  arrange(office_year)

```

### Question 3

* **Question**: Did the most common categories of spending change during COVID? For example, were members spending less on office equipment while everyone was working remotely? Or did they perhaps spend more on franked mail to communicate with constituents during isolation?

* **Analysis summary**: We found that during the height of the pandemic in 2020, DMV representatives spent way less on travel as well as rent, communication and utilities. Spending on supplies and materials peaked in 2020; we hypothesize that the switch to remote work could have necessitated more supplies for staffers. Franked mail was high in 2018, 2020 and 2022, which could be related to them being election years). Spending on printing and reproduction, as well as personnel compensation have all been rising every year. On the other had, spending on equipment has dropped dramatically.


```{r}
# Since there isn't a specific date column, we need to go by year. 2020 and 2021 were the main COVID years.

# We need to look at total spending of each category by year:

category_by_year <- totals_dmv_spend |> 
  filter(office_year >= 2018, office_year <= 2022)|> 
  group_by(office_year, purpose) |> 
  summarize(total_spend = sum(amount)) |> 
  drop_na()

category_by_year

# It's really hard to compare the amounts by just looking at the table. A visualization would greatly help with comparing the different categories:

category_by_year |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  facet_wrap(~purpose) +
  labs(x="Year",
       y="Amount Spent")

# Because personnel compensation is so much greater than all other categories, it's throwing off the scale of the visualization. Let's remove it and look at the other 8 categories side by side. 

category_by_year |> 
  filter(purpose != "PERSONNEL COMPENSATION TOTALS:")|> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  facet_wrap(~purpose) +
  labs(x="Year",
       y="Amount Spent")


# We can also look more closely at all of the 9 categories.

category_by_year |> 
  filter(purpose == "PERSONNEL COMPENSATION TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="PERSONNEL COMPENSATION",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "EQUIPMENT TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="EQUIPMENT",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "FRANKED MAIL TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="FRANKED MAIL",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "OTHER SERVICES TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="OTHER SERVICES",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "PRINTING AND REPRODUCTION TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="PRINTING AND REPRODUCTION",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "RENT  COMMUNICATION  UTILITIES TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="RENT COMMUNICATION UTILITIES",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "SUPPLIES AND MATERIALS TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="SUPPLIES AND MATERIALS",
       caption="source: ProPublica")

category_by_year |> 
  filter(purpose == "TRAVEL TOTALS:") |> 
  ggplot() +
  geom_line(aes(x=office_year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="TRAVEL",
       caption="source: ProPublica")

```

We wanted to create a line graph showing the trends over time of all 9 spending categories. We weren't sure how to code that so we asked ChatGPT for help, "I am working in R and using ggplot to visualize a dataset called category_by_year The columns are office_year, purpose and total_spend. I want to create a line graph where the x axis is office_year, the y axis is the  total_spend and there is a line representing each of the nine different values that appear in the purpose column. Write me that code."
 
It said, "Certainly! You can use ggplot2 in R to create a line graph with separate lines for each unique value in the 'purpose' column. Here's an example code to achieve this:

library(ggplot2)

# Ensure 'office_year' is in the correct format
category_by_year$office_year <- as.factor(category_by_year$office_year)

# Create the plot
ggplot(category_by_year, aes(x = office_year, y = total_spend, group = purpose, color = purpose)) +
  geom_line() +
  labs(x = "Office Year", y = "Total Spend", title = "Total Spend by Purpose over Years") +
  theme_minimal()" 


```{r}

# Plot all lines together. 

# Ensure 'office_year' is in the correct format
category_by_year$office_year <- as.factor(category_by_year$office_year)

# Create the plot
ggplot(category_by_year, aes(x = office_year, y = total_spend, group = purpose, color = purpose)) +
  geom_line() +
  labs(x = "Office Year", y = "Total Spend", title = "Total Spend by Purpose over Years") +
  theme_minimal()

# Remove Personnel Compensation to better view the other 8 expense categories. 

category_by_year_8 <- category_by_year |> 
  filter(purpose != "PERSONNEL COMPENSATION TOTALS:")

# Ensure 'office_year' is in the correct format
category_by_year_8$office_year <- as.factor(category_by_year_8$office_year)

# Create the plot
ggplot(category_by_year_8, aes(x = office_year, y = total_spend, group = purpose, color = purpose)) +
  geom_line() +
  labs(x = "Office Year", y = "Total Spend", title = "Total Spend by Purpose over Years") +
  theme_minimal()

```

An interesting result is that the printing and reproduction category increased a lot in 2022. Is this a Congress-wide change or is it just in the DMV?

```{r}
printing <- spend_with_member_info |> 
  filter(category == "PRINTING AND REPRODUCTION" & sort_sequence == "DETAIL")

printing_by_year <- printing |> 
  group_by(year) |> 
  summarize(total_spend = sum(amount)) |> 
  mutate(diff_from_previous_year = total_spend - lag(total_spend))

# This shows that there is a $26,170,867 increase in spending in printing and reproduction from 2021 to 2022, more than any other year.

printing_by_year |> 
  ggplot() +
  geom_line(aes(x=year, y=total_spend))+
  labs(x="Year",
       y="Amount Spent",
       title="PRINTING AND REPRODUCTION",
       caption="source: ProPublica")

# The graph also shows this, proving that this is a Congress-wide trend and not just in the DMV.
```

Is this growth down to a few offices, where some offices are spending more than others? What is most of the money being put towards?

```{r}
printing_by_office <- printing |> 
  filter(year == 2022) |> 
  group_by(first_name, last_name) |> 
  summarise(spending = sum(amount))

# None of the offices stand out as spending significantly more than the next one. There is a huge range of spending and when arranged, they don't differ too much, which leads us to believe that the increase in spending isn't being carried by a couple of offices.

# However, the highest spenders are the offices that don't belong to a specific representative, which in total was $856K. It's not surprising because there is more than one office grouped into that category. 

printing_nameless_offices <- printing |> 
  filter(is.na(first_name) & is.na(last_name)) |> 
  group_by(office) |> 
  summarise(total_spend = sum(amount))

# Interesting. When I tried to see the offices that didn't have names attached to them to see which ones spent the most on printing, some of the offices were still those that belonged to individual reps, not sure why they didn't get a name when we joined by bioguide id earlier.

printing_by_purpose <- printing |> 
  filter(year == 2022) |> 
  group_by(purpose) |> 
  summarise(spending = sum(amount))

# The spending on printing was mainly for the purposes of frankable and non-frankable printing, as well as advertisements. Frankable printing is the one with the highest spending with $27.5 million, most likely it's for printing mail to go to constituents.
```


### Question 4

* **Question**: Let's get a sense of the high highs and low lows. What are the biggest expenses for DMV reps? Who is the most frugal spender? 

* **Analysis summary**: We know from totals_dmv_spend_purpose that personnel compensation makes up the lion's share (78%) of spending by Congress. The top expense from DMV Reps between 2018 and 2022 is from Elaine G. Luria, a Democrat from Virginia. In 2022, her staffers made at a total of $573,977.80. 

As for the lowest annual spender in the DMV, it appears at first blush to be Kweisi Mfume of Maryland, who spent $729,418.30 in 2020. That's basically a quarter million less than even the next lowest annual spend, which was Donald Beyer's $986,166.50 in 2018. But wait! A Google search tells us that Mfume was sworn in on May 5, 2020, after a special election for the seat of the late Rep. Elijah Cummings. So the honor in fact goes to Rep Don Beyer of Virginia after all. 

```{r}

# What are the top individual expenses from DMV reps, 2018-2022?

totals_dmv_spend |> 
  group_by(last_name, first_name, purpose, amount)|> 
  arrange(desc(amount))

```

## Which offices in the DMV are spending the least annually? There may be an interesting story behind lawmakers who have shown restraint in spending their budgets compared to colleagues.

```{r}

# Create a new column that sums an offices expenses into a total sum.  

spend_by_office <- totals_dmv_spend |> 
  filter(office_year >= 2018) |> 
  group_by(last_name, first_name, office_year)|> 
  summarise(office_total = sum(amount))

# Arrange to see which office spent the least over a year. 

spend_by_office |> 
   arrange(office_total)
 
```

### Question 5

* **Question**: Has staff pay kept on pace with wage growth nation-wide? The Federal Times has reported on this question, but we think it would be well-suited for data visualization.

```{r}

# If running "post-clean," read back in dmv_spend_with_member_info

dmv_spend_with_member_info <- read_csv("data/dmv_spend_with_member_info.csv")

# Look at employee compensation in the house for full-time staff. 

details_dmv_staff_pay <- dmv_spend_with_member_info %>%
  filter(category == "PERSONNEL COMPENSATION") %>%
  filter(office_year >= 2018) %>%
  # exclude interns, temporary and part-time employees, and total/subtotal rows 
  filter(program != "INTERN ALLOWANCES") %>%
  filter(purpose != "PERSONNEL COMPENSATION TOTALS:" & purpose != "TEMPORARY EMPLOYEE" & purpose != "PAID INTERN" & purpose != "PART-TIME EMPLOYEE (OTHER COMPENSATION)" & purpose != "PART-TIME EMPLOYEE (OTHER COMPENSATION)" & purpose != "PART-TIME EMPLOYEE" & purpose != "OFFICE TOTALS:" & purpose != "OFFICIAL EXPENSES OF MEMBERS TOTALS") %>%
  select(-organization_code, -program_code, -budget_object_class, -data_source, -document, -vendor_id, -budget_object_code, -transcode, -recordid, -id, -sort_subtotal_description, -transaction_date, -date)

details_dmv_staff_pay

```

Here's where we run into an issue: each of these rows might pertain to different lengths of time, making direct comparison of various amounts (or incorporation into a reliable average) a bit difficult. For example, there's a staff assistant's record that only pertains to 2022-05-02 through 2022-06-30, while other records pertain to the full Q2. This could be for a variety of reasons -- hires or resignations mid-quarter, staff moving from the "official" side to the "campaign" side during an election year, etc.

This is a significant limitation on our ability to easily answer this question using this data set that we didn't recognize earlier.

Although it's not a perfect solution, let's standardize the "amount" values by using the start date and end date of each expense to calculate how many days of a staffer's salary the expense covers. We'll then divide the "amount" col by that number of days, and then multiply it by 91.25 (365/4). These numbers won't be 100% accurate vs their real salaries, but should get us within spitting distance and serve as a pretty rough estimate of what their quarterly (and then annual) salary would be.

```{r}

details_dmv_staff_pay <- details_dmv_staff_pay %>%
  mutate(days_covered = as.numeric(difftime(end_date, start_date, units = "days"))+1) %>%
  mutate(est_quarterly_pay = amount / days_covered * 91.25) %>%
  mutate(est_annual_pay = est_quarterly_pay * 4)


details_dmv_staff_pay

```

Now let's calculate a per-role, per-year avg salary. NOTE: "Other compensation" records seem to be one-time additional payments (do congressional staffers earn bonuses?...) rather than a normal part of staffers' salaries so I'm excluding them. Same with overtime pay.

```{r}

cleaned_details_dmv_staff_pay <- details_dmv_staff_pay %>%
  filter(!str_detect(purpose, "OTHER COMPENSATION") & !str_detect(purpose, "OVERTIME")) %>%
  select(office_year, payee, purpose, est_annual_pay) %>%
  distinct() %>%
  group_by(office_year, purpose) %>%
  summarise(avg_salary = sum(est_annual_pay) / n()) %>%
  arrange(avg_salary)

cleaned_details_dmv_staff_pay

```

It's hard to identify which records or job titles are permanent staff positions vs temporary, contract, etc. expenses without manually checking each of the hundreds of grouped values in the "purpose" column, seeing which dates and frequencies they appear, and then using best judgement/assumptions to further standardize or filter. We weren't feeling confident in the likelihood that the results would be accurate due to all of the factors discussed above.

Let's select and plot just a few roles' averages against national wage growth data just for comparison's sake. However, note that these results are also fuzzy/difficult to use since some job titles suggest dual roles for certain staffers (for example, some schedulers might just be schedulers, while others are both schedulers/press assistant or schedulers/deputy comm dirs, etc.)

```{r}

# get a df with avg annual pay for leg aides, press secs, and schedulers (for job titles ONLY described as schedulers, none with dual roles)

cleaned_details_dmv_staff_pay <- cleaned_details_dmv_staff_pay %>%
  filter(purpose == "SCHEDULER" | purpose == "LEGISLATIVE AIDE" | purpose == "PRESS SECRETARY" | purpose == "CHIEF OF STAFF" | purpose == "LEGISLATIVE DIRECTOR") %>%
  rename("job_title" = "purpose",
         "year" = "office_year") %>%
  arrange(year)

cleaned_details_dmv_staff_pay

```

```{r}
# update the national_wage df to allow for binding and plotting with the staff pay df from above

national_wages <- read_csv("data/national_average_wage_index.csv") |> clean_names() %>%
  rename("avg_salary" = "index") %>%
  mutate(job_title = "NATIONAL WAGES") %>%
  select(year, job_title, avg_salary) %>%
  filter(year >= 2018)

national_wages 
```

```{r}
wage_comparison_df <- rbind(cleaned_details_dmv_staff_pay, national_wages) %>%
  arrange(year)

wage_comparison_df
```

```{r}
ggplot(wage_comparison_df, aes(x = year, y = avg_salary, color = job_title)) +
  geom_line() +
  geom_point() +
  labs(title = "Leg. aide wages remain behind national average",
       x = "Year",
       y = "Average Salary",
       color = "Job Title") +
  theme_minimal()
```

Let's try to switch gears and just look at a percent change in staff salaries year over year using subtotal records, and compare that to national trends in wage growth. However, the accuracy of those calculations would rely on a big assumption that the level of staffing has stayed constant and offices have not grown or shrunk year-to-year.

```{r}
# calculate % change in personnel expenditures since 2018 for DMV reps

totals_dmv_spend_pct_change <- totals_dmv_spend %>%
  filter(purpose == "PERSONNEL COMPENSATION TOTALS:",
         program == "OFFICIAL EXPENSES OF MEMBERS") %>%
  filter(office_year >= 2018) %>%
  group_by(office_year) %>%
  summarise(amount = sum(amount)) %>%
  # 2018's amount was 18388218.1, so each year's percent growth should be calculate off of that number to get cumulative growth since 2018
  mutate(pct_change = (amount - 18388218.1) / 18388218.1 * 100) %>%
  mutate(data_source = "DMV Personnel Expenditure Subtotals")

totals_dmv_spend_pct_change
```

```{r}
# calculate annual % change in personnel expenditures for national wage avgs

national_wages_pct_change <- national_wages %>%
  mutate(pct_change = (avg_salary - 52145.80) / 52145.80 * 100) %>%
  mutate(data_source = "National Wage Avgs") %>%
  rename("amount" = "avg_salary") %>%
  select(-job_title)

national_wages_pct_change
```

```{r}
# bind the data

national_wages_pct_change <- national_wages_pct_change %>%
  rename("office_year" = "year")

wage_comparison_pct_change_df <- rbind(totals_dmv_spend_pct_change, national_wages_pct_change) %>%
  arrange(office_year)

wage_comparison_pct_change_df
```
```{r}
# visualize

ggplot(wage_comparison_pct_change_df, aes(x = office_year, y = pct_change, color = data_source, group = data_source)) +
  geom_line() +
  geom_point() +
  labs(title = "Growth in DMV Personnel Pay Outpaces National Trends",
       x = "Year",
       y = "Percent Change vs 2018",
       color = "") +
  theme_minimal()

# Display the plot
print(ggplot())
```

Growth in total personnel expenses for DMV representatives is outpacing wage growth, with an even bigger gap by 2022. What about if we consider all member offices nationally?

```{r}
# We were directly modifying/updating house_spend_18_22 earlier so lets revert back to the original df

house_spend_18_22 <- read_csv("data/house_spend_18_22.csv")


# calculate % change in personnel expenditures since 2018 for DMV reps

totals_house_spend_pct_change <- house_spend_18_22 %>%
  filter(purpose == "PERSONNEL COMPENSATION TOTALS:",
         program == "OFFICIAL EXPENSES OF MEMBERS") %>%
  filter(office_year >= 2018) %>%
  group_by(office_year) %>%
  summarise(amount = sum(amount)) %>%
  # 2018's amount was 412062623, so each year's percent growth should be calculated off of that number to get cumulative growth since 2018
  mutate(pct_change = (amount - 412062623) / 412062623 * 100) %>%
  mutate(data_source = "National Personnel Expenditure Subtotals")

totals_house_spend_pct_change
```

bind and re-plot alongside the dmv personnel growth and national wage growth data

```{r}

full_wage_comparison_pct_change_df <- rbind(totals_dmv_spend_pct_change, national_wages_pct_change, totals_house_spend_pct_change) %>%
  arrange(office_year)

full_wage_comparison_pct_change_df

```


```{r}
# visualize

ggplot(full_wage_comparison_pct_change_df, aes(x = office_year, y = pct_change, color = data_source, group = data_source)) +
  geom_line() +
  geom_point() +
  labs(title = "",
       x = "Year",
       y = "Percent Change vs 2018",
       color = "") +
  theme_minimal()

# Display the plot
print(ggplot())
```
Very similar trends as the DMV's.

Since different members were present for during different, minimum salary requirements were set for the first time in late 2022, and maximum allowable salary levels were increased, we can't make a direct comparison of salary growth across ALL years for representatives who served (for example) from 2017-2019 vs representatives who served from 2017-2023.

But out of all offices nationally, are there any offices whose spending on personnel expenses lag far behind the national trends for particular years?

```{r}

totals_members_personnel_spend <- house_spend_18_22 %>%
  filter(purpose == "PERSONNEL COMPENSATION TOTALS:",
         program == "OFFICIAL EXPENSES OF MEMBERS") %>%
  filter(office_year >= 2018) %>%
  group_by(office_year, bioguide_id) %>%
  summarise(amount = sum(amount)) %>%
  arrange(office_year, amount)

totals_members_personnel_spend

```

```{r}
# Compare annual personnel expenses for each member against the avg personnel spend for all members for each year

members_annual_personnel_spend <- house_spend_18_22 %>%
  filter(!is.na(bioguide_id)) %>%
  filter(purpose == "PERSONNEL COMPENSATION TOTALS:",
         program == "OFFICIAL EXPENSES OF MEMBERS",
         office_year >= 2018) %>%
  group_by(bioguide_id, office_year) %>%
  summarise(annual_personnel_expenses = sum(amount))

members_annual_personnel_spend
```

```{r}
# Calculate the average spend across all members each year
house_average_personnel_expenses <- members_annual_personnel_spend %>%
  group_by(office_year) %>%
  summarize(house_avg_personnel_expenses = mean(annual_personnel_expenses))

# join the original data frame with the calculated averages
members_annual_personnel_spend <- left_join(members_annual_personnel_spend, house_average_personnel_expenses, by = 'office_year')

members_annual_personnel_spend

# Filter rows where annual_personnel_expenses is lower than the average
lower_personnel_spenders <- members_annual_personnel_spend %>%
  filter(annual_personnel_expenses < house_avg_personnel_expenses) %>%
  arrange(annual_personnel_expenses)


lower_personnel_spenders
```

Some of the lower totals here (eg SUSAN WILD and MARY GAY SCANLON in 2018) seem to be because the member hadn't taken office yet. That's somewhat interesting and surprising in its own right -- there are some members spending taxpayer money before they're even sworn into office?

Others like KEVIN HERN and MICHAEL CLOUD were appointed or won special elections mid-cycle.

Others like TROY BALDERSON and JOHN R. CURTIS seem to have multiple bioguide_ids that we didn't catch in our earlier cleaning. Upon further investigation, this is an issue within the original expenses data. For example, LINDA T. SANCHEZ only has one bioguide_id in the ppcong data across all relevant years but for unknown reasons she has two different ids within the same years in the expenses data. We didn't catch this because we checked for bioguide_id issues based on whether any members didn't receive an id during the join of those two data sets, which didn't happen here. If we had time we would go back and examine this further, fix the issue(s), and rerun.

Of the members for whom we didn't identify complicating factors that might explain their low personnel expenses, TED BUDD (B001305) in 2018 is an example of someone who simply seems to have spent relatively very little on personnel expenses. He only spent 596,056.30 vs a House-wide average of 910,555.90 that year. It would be worth digging into this further outside the data and seeing if Budd, and other members like him who spend much less on personnel, experienced higher staff turnover than most offices if his staff pay was so much lower and/or if he maintained a smaller staff.


Another supposedly low spender, Pat Tiberi, caught my eye:

```{r}
spend_with_member_info %>%
  filter(bioguide_id == "T000462",
         category == "PERSONNEL COMPENSATION")

```

PATRICK J. TIBERI was only in office for 15 days in 2018 but somehow still managed to spend nearly 500k in personnel expenses?? We need to examine the details of that further:

```{r}

spend_with_member_info %>%
  filter(office_year == 2018) %>%
  filter(bioguide_id == "T000462") %>%
  filter(start_date > "2018-01-15")
  

```

Look at the start and end dates -- why are there expenses in September, MONTHS after he left office, and some even after the seat was filled by a new person? Some of the expenses seem like contractual obligations like rent, but why are personnel expenses still being paid, franked mail being sent?... I was wondering if district staff might stay on to support constituents until the seat is filled, but these expenses include pay for Hill staff too (like Chief of Staff, Deputy Chief of Staff, Legislative Assistant, etc.)


### Question 6: What's up with Intern Allowances? 

* **Question**: We excluded Intern Allowances very early in our analysis to only look at regular member expenses. So we decided to go back and take a look to see what patterns we could observe about intern pay. 

* **Analysis summary**: Through this analysis we found that the House had strict caps on intern pay. In 2019, it was $20K total; in 2020 & 2021, $25K; in 2022, $35K. 

Many reps appear to be maximizing this line item, which makes sense to us. We did find a curious outlier. In 2019, Rep. John Carter from Texas spent $29,813.33 on interns, above the apparent ceiling of $20K. We could not figure out why that may be with the information in the dataset, and think it could deserve a closer look via other reporting methods outside of R. 

Strangely, we didn't find any Intern Allowances for 2018 when searching by program == INTERN ALLOWANCES. That couldn't be right, so we searched by the purpose column instead and voilà. So the house must have made a change in FY19 around how intern expenses were categorized in these reports. Strangely, the amount that reps spend on interns in 2018 appeared to vary widely and one rep, Thomas Massie from Kentucky, spent upwards of $43K on interns that year. In 2018 a total of 11 reps spend over $20K on interns, which would become the spending apparent cap on intern pay in the following year. 

```{r}

intern_allowances <- house_spend_18_22 |> 
  filter(program== "INTERN ALLOWANCES") |> 
  filter(purpose == "INTERN ALLOWANCES TOTALS:") |> 
  select(-start_date, -end_date, -sort_sequence, -purpose, -year, -fiscal_year_or_legislative_year)

intern_allowances |> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

# Okay, it looks like in 2022, many offices were spending $35,000 on interns or just a little less. There must have been a cap. Let's look at 2021. 

intern_allowances |> 
  filter(office_year == 2021)|> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

# Here the cap appears to be $25,0000. Interesting, the limit must have changed. How about 2020? 

intern_allowances |> 
  filter(office_year == 2020)|> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

# Alright, that year seemed to also be a $25,0000 cap. How about 2019? 

intern_allowances |> 
  filter(office_year == 2019)|> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

# Huh. Jon Carter spent nearly $30,000 on interns in 2019, when everyone else was spending a maximum of $20,000. Let's look closer at Carter's intern spend in 2019. 

house_spend_18_22 |> 
  filter(office_year == 2019)|> 
  filter(bioguide_id == "C001051")|> 
  filter(purpose == "INTERN ALLOWANCES TOTALS:")

# Why does Carter have 2 entries for quarters 2, 3 & 4 in 2019? We need to so some digging by looking at the detail level of his intern expenditures in 2019

carter_19 <- spend_with_member_info |> 
  filter(bioguide_id == "C001051")|> 
  filter(sort_sequence == "DETAIL")|> 
  filter(program == "INTERN ALLOWANCES")|> 
  mutate(office_year = as.numeric(sub(".*?(\\d{4}).*", "\\1", office)))|> 
  filter(office_year == 2019)

total <- sum(carter_19$amount)
total

# Yeah, still getting almost $30K. And after manually scanning, it doesn't look like any of these expenses are duplicates. 

# Last but not least, let's look at 2018. 

intern_allowances |> 
  filter(office_year == 2018)|> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

# There are zero results for 2018! Were interns not paid in 2018? Very weird. Did something change that year about how the House tracked intern expenses? Let's look at the detail level from 2018. 

detail_18 <- spend_with_member_info |> 
  filter(sort_sequence == "DETAIL")|> 
  mutate(office_year = as.numeric(sub(".*?(\\d{4}).*", "\\1", office)))|> 
  filter(office_year == 2018)

interns_18 <- detail_18 |> 
  filter(str_detect(purpose, "INTERN"))

# AHA! Some shuffling of how intern expenses are categorized definitely happened in after 2018. Starting in 2019, there is  program called INTERN ALLOWANCES. But in 2018, the intern expenses can be found by using the purpose column instead. In 2018, the program column for rows with intern expenses may GENERAL EXPENDITURES, SALARIES OFFICERS & EMPLOYEES, and more. So that's fun. Let's try again to total intern expenses by House member using purpose instead of program. 

interns_18  |> 
  group_by(bioguide_id, first_name, last_name) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(desc(annual_intern_spend))

massie_interns_18 <- interns_18  |> 
  filter(bioguide_id == "M001184")

massie_total_18 <- sum(massie_interns_18$amount)
massie_total_18

# Fascinating. Now we see that in 2018 reps such as Thomas Massie (R-KY) spent over $43K on interns. That's a lot higher! The House must have cracked down on paid intern spend after that year, it would be really interesting to figure out what happened. 

```

Are any offices spending significantly LESS than their allotted budget for interns? (Only interested in 2019 onward since offices had NO dedicated intern budget in 2018)

```{r}
intern_allowances <- house_spend_18_22 |> 
  filter(program== "INTERN ALLOWANCES") |> 
  filter(purpose == "INTERN ALLOWANCES TOTALS:") |> 
  select(-start_date, -end_date, -sort_sequence, -purpose, -year, -fiscal_year_or_legislative_year)

intern_allowances |> 
  group_by(bioguide_id, office_year) |> 
  summarise(annual_intern_spend = sum(amount))|> 
  arrange(annual_intern_spend)

```

One in five offices are spending 10k or less on intern allowances despite having at least 20k to spend. This is really surprising since there's no shortage of college students competing for a Hill internship, and you'd think that member offices would want to take advantage of a dedicated fund for additional labor as much as possible.

The smallest amount in the data belongs to GILBERT RAY CISNEROS  JR (C001123), only spent $46.16 on intern allowances in 2021. This makes sense because he was defeated in the 2020 election and only had a handful of days in office in 2021.

However, there are also people like STEVE CHABOT (C000266) who simply spent very small amounts of their intern allowance budgets.

BILL PASCRELL  JR. (P000096) is another one of those low spenders and unlike Chabot, he's still in office. At least nowadays, he also has an active internship application page, so I'm going to guess that this isn't simply a matter of them not accepting any interns. Diving into the detail level data, the INTERN ALLOWANCE TOTALS: seem to capture all spending -- I opened up spend_with_member_info, filtered the bioguide_id by Pascrell's ID, and used the search bar to search ALL columns for "intern" and I don't think any more intern pay is hiding somewhere else.

This might be worth looking into further, calling Pascrell's office, and trying to understand it better. Is there an issue with the data and/or are we looking at it wrong? Or for some reason are certain offices like Pascrell's disregarding the time honored tradition of recruiting interns to sort mail from constituents? If so, why?


### FINAL PITCH MEMO 

Our data analysis of expenditure reports from the House of Representatives between 2018 and 2022 yielded several newsworthy findings that merit further investigation. The public deserves a transparent accounting of their representatives’ budgets, yet the publicly-available data requires careful cleaning and diligent examination to uncover trends and outliers. Continued reporting on this subject would serve public interest by increasing transparency and holding elected officials accountable for their spending. 

** Findings ** 

There appears to be an anomaly in the data regarding expenses from the office of Rep. Patrick J. Tiberi (R-OH). Tiberi resigned from the House on Jan. 15, 2018, and his seat was filled on Sept. 5, 2018. However, he has expense records until at least Sept. 17, 2018. Some seem like contractual obligations like rent, but why are personnel expenses still being paid, franked mail being spent, etc.? We wondered if the expenses could be explained if district staff stayed to support constituents for a short time after vacancy, but these expenses also include pay for Hill staff too (like Chief of Staff, Deputy Chief of Staff, Legislative Assistant, etc.) Were these expenses incorrectly attributed to Tiberi in the data? If not, how and why was his office able to continue spending taxpayer dollars well beyond the end of his tenure?

We also uncovered patterns related to intern compensation in the House. Representatives’ spending on intern allowances varied widely in 2018, but shifted to strict pay ceilings from 2019-2022. In 2019, intern spending was capped at $20,000 annually per office, which increased to $25,000 in 2020 and $35,000 in 2022. We found one outlier to the intern spending trends. In 2018, Rep. John Carter (R-TX) spent more than $29,000 on interns, vastly outspending his peers who didn’t cross the threshold of $20,000.

Additionally, there are instances where certain members appeared to spend significantly less on personnel expenses than their peers. Of the members for whom we didn't identify complicating factors that might explain their low personnel expenses (e.g. resignations, special elections mid-cycle, etc.), Rep. Ted Budd (R-NC) in 2018, for example, simply seems to have spent relatively very little on personnel expenses. He only spent $596,056.30 on personnel vs a House-wide average of $910,555.90 that year. . It would be worth digging into this further outside the data and seeing if Budd experienced higher staff turnover than most offices due to his staff pay being lower (or his staff possibly being much smaller than average instead).

We sought to find local stories by focusing on representatives from DC, Maryland and Virginia. We found, as expected, that reps from the DMV spent less overall than their colleagues due to proximity to the capital. Even though DMV reps spent relatively more on staff compensation and rent and utilities, their significantly smaller spend on travel reduced their overall spending. 

We also looked into spending by party for DMV reps to determine whether Democrats or Republicans spent more annually, and whether the majority party members spent more or less. We did not find a strong correlation in the data and would not pursue this question further in our reporting. 

We also looked at spending over time for DMV reps, and we found that spending for travel dropped significantly in 2020 likely due to the pandemic. In addition, we also found that spending on franked mail was higher every other year (2018, 2020 and 2022), potentially due to those being election years. Personnel compensation was also on a steady rise over the last five years in conjunction with wages increases in general in the U.S.

One statistic that caught our eye was the printing and reproduction expenses. They seem to have skyrocketed from 2021 to 2022, with an over $26 million increase. Upon further analysis, we found that the highest amount of the money went towards frankable printing and advertising. This could be down to 2022 being an election year, however, there wasn’t a huge difference between 2018 and 2019, with 2018 also being an election year. What makes 2022 different? This could be something to investigate further.



** Verification & Next Steps ** 

To look more closely into the intern spending for Rep. John Carter (R-TX), we would look online and potentially make a FOIA request to see his detailed 2018 budget. We could also cross-check the original expense data from ProPublica against data available through house.gov (https://www.house.gov/the-house-explained/open-government/statement-of-disbursements) or private organizations that collect similar data like LegiStorm. We would reach out to Carter or his Chief of Staff for comment . Interviews with former interns could also help to paint a clearer picture of how Carter used intern labor. 

We could apply similar steps to verify the rules regarding an office continuing to spend taxpayer money even after the member has resigned and the seat has been filled by another person. We would also want to explore the data further (and/or investigate outside the data) to see if there are any similar instances of an office continuing to spend official funds long after the member has vacated the seat and even after the seat has been filled by someone else. 

If the data is verified, we could confirm the rules on intern spending and post-resignation spending with relevant oversight bodies in the House to determine whether the relevant offices broke any rules.

We would want to find additional data and conduct interviews with members who spent less on personnel expenses to understand why, whether that equated to lower pay for staff members or a smaller staff pool, and whether those factors affected staff turnover. That could rabbit-hole even further – for example, if it affects turnover, does that in turn affect a member’s work output, i.e. fewer sponsored bills or poor response time to constituent calls and letters?

To determine why DMV reps are spending more on salaries and rent, we could also FOIA detailed office budgets for each representative. Perhaps the variance can be attributed to the cost of living and commercial real estate market in the DMV alone, but it’s possible there is something more to uncover.

We could also do something similar in order to better understand why House reps spent significantly more on printing and reproduction in 2022 in comparison to other years. Did it have anything to do with the midterm elections? If so, how have methods of communicating with voters changed over the last five years? These would be questions we’d ask members.

** Data Strengths & Weaknesses ** 

The most significant weaknesses in the data pertain to personnel expenses. First, there are inconsistent expense dates for staff members. These observations could be for a variety of reasons -- hires or resignations mid-quarter, staff moving from House to the campaign trail during an election year, etc. We standardized the data to estimate a rough annualized salary for all recipients of personnel expenses. But that process also means that recipients of large one-time or short-term payments (likely temps or contractors) look like they’ve received much more than they actually did.

Additionally, some job titles suggest dual roles for certain staffers. For example, some schedulers might just be schedulers, while others are both scheduler/press assistant or scheduler/deputy communications director. This made it difficult to compare staff pay for the same or similar roles across individual offices.

Finally, some members were assigned multiple unique identifiers called bioguide ids within the original expense data. Those members’ subtotal records are split up across multiple rows within the same year, which would impact the findings of any analysis that relies on grouping data by those unique identifiers. This appears to be an error, but further reporting may reveal why a representative was assigned multiple bioguide ids

